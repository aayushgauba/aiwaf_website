<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-WAF - Django Middleware Documentation</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            background: rgba(16, 16, 30, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #4ecdc4;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 6rem 2rem 2rem;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            height: fit-content;
            position: sticky;
            top: 6rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar h3 {
            color: #4ecdc4;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin: 0.5rem 0;
        }

        .sidebar a {
            color: #cccccc;
            text-decoration: none;
            transition: color 0.3s ease;
            font-size: 0.9rem;
        }

        .sidebar a:hover, .sidebar a.active {
            color: #4ecdc4;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .page-description {
            font-size: 1.1rem;
            color: #cccccc;
            margin-bottom: 3rem;
        }

        .section {
            margin: 3rem 0;
        }

        .section h2 {
            color: #ff6b6b;
            margin: 2rem 0 1rem;
            font-size: 1.8rem;
        }

        .section h3 {
            color: #4ecdc4;
            margin: 1.5rem 0 1rem;
            font-size: 1.4rem;
        }

        .section h4 {
            color: #4ecdc4;
            margin: 1rem 0 0.5rem;
            font-size: 1.2rem;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 1.5rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            color: #4ecdc4;
            margin: 1rem 0;
            overflow-x: auto;
            border: 1px solid rgba(78, 205, 196, 0.3);
            white-space: pre-wrap;
            line-height: 1.4;
        }

        .info-box {
            background: rgba(78, 205, 196, 0.1);
            border-left: 4px solid #4ecdc4;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 10px 10px 0;
        }

        .warning-box {
            background: rgba(255, 107, 107, 0.1);
            border-left: 4px solid #ff6b6b;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 10px 10px 0;
        }

        .method-doc {
            background: rgba(78, 205, 196, 0.1);
            border-left: 4px solid #4ecdc4;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 10px 10px 0;
        }

        .method-doc h6 {
            color: #4ecdc4;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
        }

        .feature-list {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: 6rem 1rem 2rem;
            }
            
            .sidebar {
                position: static;
            }
            
            .main-content {
                padding: 2rem;
            }
            
            .page-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">AI-WAF</div>
            <nav>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/docs">Documentation</a></li>
                    <li><a href="/docs/django">Django</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <aside class="sidebar">
            <h3>Django Documentation</h3>
            <ul>
                <li><a href="/docs/django">Overview</a></li>
                <li><a href="/docs/django/installation">Installation</a></li>
                <li><a href="/docs/django/middleware" class="active">Middleware</a></li>
                <li><a href="/docs/django/configuration">Configuration</a></li>
                <li><a href="/docs/django/commands">Management Commands</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <h1 class="page-title">Django Middleware Documentation</h1>
            <p class="page-description">
                Comprehensive documentation for AI-WAF Django middleware components, including detailed explanations of their functionality, configuration options, and implementation details.
            </p>

            <div class="section">
                <h2><i class="fas fa-shield-alt"></i> IPAndKeywordBlockMiddleware</h2>
                <p>The core middleware that provides intelligent keyword-based blocking with machine learning capabilities. It automatically learns from attack patterns and blocks malicious requests while avoiding false positives on legitimate traffic.</p>
                
                <h3>Key Features</h3>
                <div class="feature-list">
                    ‚ú® <strong>Smart Learning:</strong> Automatically learns suspicious keywords from attack attempts<br>
                    üéØ <strong>Context-Aware Blocking:</strong> Considers request context to reduce false positives<br>
                    üîó <strong>Django Integration:</strong> Automatically extracts legitimate keywords from Django URLs and models<br>
                    üõ°Ô∏è <strong>Exemption System:</strong> Supports IP and keyword exemptions for legitimate traffic<br>
                    üîÑ <strong>Dynamic Adaptation:</strong> Adapts to new attack patterns in real-time
                </div>

                <h3>Class Structure</h3>
                <div class="code-block">class IPAndKeywordBlockMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response
        self.safe_prefixes = self._collect_safe_prefixes()
        self.exempt_keywords = self._get_exempt_keywords()
        self.legitimate_path_keywords = self._get_legitimate_path_keywords()
        self.malicious_keywords = set(STATIC_KW)</div>

                <h3>Core Methods</h3>
                
                <div class="method-doc">
                    <h6>_get_exempt_keywords()</h6>
                    <p>Collects keywords that should be exempt from blocking. Sources include:</p>
                    <ul>
                        <li>AIWAF_EXEMPT_PATHS setting</li>
                        <li>AIWAF_EXEMPT_KEYWORDS setting</li>
                        <li>Extracted path segments from exempt URLs</li>
                    </ul>
                </div>

                <div class="method-doc">
                    <h6>_get_legitimate_path_keywords()</h6>
                    <p>Identifies legitimate keywords that should not trigger blocks. Uses trainer.py logic for consistency:</p>
                    <ul>
                        <li>Common legitimate path segments (admin, api, user, etc.)</li>
                        <li>Django URL pattern keywords</li>
                        <li>Django app names and model names</li>
                        <li>Custom allowed keywords from settings</li>
                    </ul>
                </div>

                <div class="method-doc">
                    <h6>_extract_django_route_keywords()</h6>
                    <p>Automatically extracts legitimate keywords from your Django application:</p>
                    <ul>
                        <li>App configuration names and labels</li>
                        <li>Model names (singular and plural forms)</li>
                        <li>URL pattern segments</li>
                        <li>View function names</li>
                        <li>URL namespaces</li>
                    </ul>
                </div>

                <div class="method-doc">
                    <h6>_is_malicious_context(request, segment)</h6>
                    <p>Determines if a keyword appears in a suspicious context:</p>
                    <ul>
                        <li>Query parameter attacks (SQL injection patterns)</li>
                        <li>File extension attacks (.php, .asp on Django sites)</li>
                        <li>Directory traversal attempts (../, ..\\)</li>
                        <li>Access to non-existent paths with suspicious extensions</li>
                    </ul>
                </div>

                <div class="method-doc">
                    <h6>_collect_safe_prefixes()</h6>
                    <p>Collects URL prefixes that are known to be safe based on Django URL configuration. Requests starting with these prefixes are treated more leniently.</p>
                </div>

                <h3>Blocking Logic Process</h3>
                <div class="feature-list">
                    <strong>1. Early Exemption:</strong> Check if request/IP is exempted<br>
                    <strong>2. IP Blacklist Check:</strong> Verify if IP is already blocked<br>
                    <strong>3. Path Validation:</strong> Check if requested path exists in Django<br>
                    <strong>4. Smart Learning:</strong> Learn from suspicious patterns on non-existent paths<br>
                    <strong>5. Context Analysis:</strong> Apply different rules for valid vs invalid paths<br>
                    <strong>6. Keyword Filtering:</strong> Filter out legitimate keywords based on context<br>
                    <strong>7. Malicious Detection:</strong> Identify inherently suspicious patterns<br>
                    <strong>8. Conservative Blocking:</strong> Use strict criteria for blocking valid paths
                </div>

                <h3>Configuration Options</h3>
                <div class="code-block"># Django settings.py - IPAndKeywordBlockMiddleware Configuration

AIWAF_EXEMPT_PATHS = [
    '/admin/',           # Django admin interface
    '/api/v1/',         # API endpoints
    '/static/',         # Static files
    '/media/',          # Media files
    '/health/',         # Health check endpoints
    '/webhooks/',       # Webhook endpoints
]

AIWAF_EXEMPT_KEYWORDS = [
    'legitimate_keyword1',
    'custom_app_name',
    'special_feature_name'
]

AIWAF_ALLOWED_PATH_KEYWORDS = [
    'myapp',            # Your custom app names
    'dashboard',        # Custom dashboard features
    'reports'           # Business-specific terms
]

# Number of top learned keywords to actively use for blocking
AIWAF_DYNAMIC_TOP_N = 10

# Minimum keyword length to consider for learning (default: 3)
AIWAF_MIN_KEYWORD_LENGTH = 3</div>

                <div class="info-box">
                    <strong>üí° Pro Tips:</strong><br>
                    ‚Ä¢ The middleware automatically learns your Django app structure<br>
                    ‚Ä¢ It's more lenient with requests to valid Django URLs<br>
                    ‚Ä¢ False positives can be reduced by adding legitimate terms to AIWAF_EXEMPT_KEYWORDS<br>
                    ‚Ä¢ Monitor logs to fine-tune exemption settings<br>
                    ‚Ä¢ The learning algorithm focuses on non-existent paths to avoid learning from legitimate traffic
                </div>

                <h3>How It Works</h3>
                <div class="info-box">
                    <p><strong>üß† Intelligent Processing Flow:</strong></p>
                    <p>The middleware analyzes each incoming request through multiple layers of intelligence:</p>
                    <ul>
                        <li><strong>Path Analysis:</strong> Determines if the requested URL exists in your Django application</li>
                        <li><strong>Keyword Extraction:</strong> Breaks down URLs into segments and analyzes each part</li>
                        <li><strong>Context Evaluation:</strong> Considers the context of suspicious keywords (query parameters, file extensions, etc.)</li>
                        <li><strong>Learning Process:</strong> Only learns from non-existent paths to avoid false positives</li>
                        <li><strong>Smart Filtering:</strong> Applies different rules for valid vs. invalid paths</li>
                        <li><strong>Conservative Blocking:</strong> Uses strict criteria before blocking legitimate traffic</li>
                    </ul>
                </div>

                <div class="warning-box">
                    <h4>üìù Implementation Notes</h4>
                    <p><strong>The middleware is designed to be:</strong></p>
                    <ul>
                        <li><strong>Conservative:</strong> Errs on the side of allowing traffic rather than blocking</li>
                        <li><strong>Context-Aware:</strong> Considers the full request context before making decisions</li>
                        <li><strong>Self-Learning:</strong> Improves over time by learning from real attack patterns</li>
                        <li><strong>Django-Native:</strong> Understands your Django app structure automatically</li>
                    </ul>
                    <p>The implementation includes sophisticated pattern matching, exemption handling, and machine learning algorithms that adapt to your specific application.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Header scroll effect
        const header = document.querySelector('.header');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 100) {
                header.style.background = 'rgba(16, 16, 30, 0.95)';
            } else {
                header.style.background = 'rgba(16, 16, 30, 0.9)';
            }
        });
    </script>
</body>
</html>
